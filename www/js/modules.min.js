(function(jQuery){"use strict";jQuery.attachModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.$el.css("background-color","white");var checked=0;var url="../php/Attach.php";var ressourcesIncluded=[];var resourcesValIncluded=[];var monitors=""+$.getParameterByName("m");var overview=false;var timeSpanCheck=$("#timeSpanCheck");var timeSpan;var datepicker=$("#datetimepicker1");var timeSpanText=$("#timeSpanText");var attachSubmit=$("#attachSubmit");var endTime="2030-06-13 19:30:11";$("#resourceTable").find("input").change(function(){var dbId=this.id.split("-")[1];console.log(dbId);if(this.checked){checked++;ressourcesIncluded.push(dbId);resourcesValIncluded.push(this.value)}else{checked--;var index=ressourcesIncluded.indexOf(dbId);var indexValue=resourcesValIncluded.indexOf(this.value);if(index>-1){resourcesValIncluded.splice(indexValue,1);ressourcesIncluded.splice(index,1)}}});var monArray=monitors.split(",");$.each(monArray,function(index,value){if(value!=="")$(".selectedMonitor."+value).show();else overview=true});$("#continueConfig").on("click",function(){var modalResourceList=$("#modalResourceList");modalResourceList.empty();for(var i=0;i<resourcesValIncluded.length;i++){modalResourceList.append("<br>");modalResourceList.append('<i class="fa fa-check" aria-hidden="true" style="color:green"></i>'+'<i style="font-weight:600;padding-left:1.5em; display: inline-block;">'+resourcesValIncluded[i]+"</i>")}});attachSubmit.on("click",function(){console.log("monitors: "+monArray);$.post(url,{resources:ressourcesIncluded,monitors:monArray,until:endTime}).done(function(data){window.location.replace("index.php?attach=success")}).fail(function(){})});timeSpanCheck.on("click",function(){timeSpan=$("#timeSpan");if(this.checked){timeSpan.show();validateFormat()}else{endTime="2030-06-13 19:30:11";attachSubmit.prop("disabled",false);timeSpan.hide()}});var dateNow=new Date;datepicker.datetimepicker({sideBySide:true,minDate:dateNow});datepicker.on("dp.change",function(e){validateFormat()});timeSpanText.on("change",function(){validateFormat()});function validateFormat(){var inputValue=timeSpanText.val();if(checkTimeFormat(inputValue)["status"]){endTime=checkTimeFormat(inputValue)["msg"];attachSubmit.prop("disabled",false)}else{attachSubmit.prop("disabled",true)}}function checkTimeFormat(timespan){var whiteSplit=timespan.split(" ");if(whiteSplit.length!==3)return false;var date=whiteSplit[0].split("/");if(date.length!==3)return false;var time=whiteSplit[1].split(":");if(time.length!==2)return false;if(parseInt(time[0])>12||parseInt(time[0])<0)return false;if(whiteSplit[2]!=="PM"&&whiteSplit[2]!=="AM")return false;if(whiteSplit[2]==="PM")time[0]=" "+(parseInt(time[0])+12);var timeFormated=time[0]+":"+time[1]+":00";var dateFormated=date[2]+"-"+date[0]+"-"+date[1];var until=dateFormated+" "+timeFormated;return{status:true,msg:until}}};base.init()};jQuery.fn.attachModule=function(options){return this.each(function(){new jQuery.attachModule(this,options)})}})(jQuery);var ics_sources;(function(jQuery){"use strict";jQuery.CalDAVModule=function(el,options){var base=this;base.init=function(){base.options=$.extend({path:"empty"},options||{});base.el=el;base.$el=jQuery(el);base.getContent(base.options.path)};base.getContent=function(path){ics_sources=[{url:path}];$.getScript("../libs/icalendar2fullcalendar/wrapper.js",function(){console.log("Running wrapper.js")})};base.init()};jQuery.fn.CalDAVModule=function(options){return this.each(function(){new jQuery.CalDAVModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.deliverContentModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.types={};base.mID=getUrlVars()["mID"];base.interval=10;base.$content=base.$el.find(".content");base.contentArr=[];base.tOut={};base.colorboxOptions={rel:"slideshowElements",slideshowSpeed:base.interval*1e3,slideshow:true,open:true,closeButton:false,opacity:1,height:"100%"};console.log("deliverContentModule loaded");function postRequest(){if(base.mID!==undefined){$.post("../php/ContentManager.php",{mID:base.mID}).done(function(data){if(JSON.parse(data)["code"]!==200){if(JSON.stringify(JSON.parse(data)["msg"])==='"No mID found"'){base.$content.html('<div class="bs-callout bs-callout-warning"> '+'<h4 id="bs-header">The monitor ID '+base.mID+" is not registered in the system</h4> "+'<p>You can register this monitor with its unique <code class="highlighter-rouge">mID = '+base.mID+"</code> by clicking on the button below</p>"+'<div class="row">&nbsp;</div>'+'<button id="addMonitor" type="button" class="btn btn-default" data-dismiss="modal">add Monitor</button>'+"</div>");$("#addMonitor").on("click",function(){var url="../php/NewMonitor.php";$.post(url,{mID:base.mID}).done(function(data){location.reload()}).fail(function(data){console.log("It failed")})})}return}var tmp=JSON.stringify(base.types);base.types=JSON.parse(JSON.parse(data)["msg"]);var newData=JSON.stringify(base.types);if(tmp.localeCompare(newData)!==0){updateView()}}).fail(function(data){base.$content.html(JSON.stringify(JSON.parse(data)))})}else{base.$content.html('<div class="bs-callout bs-callout-warning"> '+'<h4 id="bs-header">The system could not find the monitor ID</h4> '+'<p>Ensure that you have set up the URL parameters correctly: <code class="highlighter-rouge">/?mID=</code>[Insert Monitor ID]</p>'+"</div>")}}function timedPoll(){postRequest();setTimeout(function(){timedPoll()},base.interval*1e3)}function updateView(){base.$content.html("");base.contentArr=[];if(!(0<base.types["pdf"]["no"]||0<base.types["website"]["no"]||0<base.types["image"]["no"]||0<base.types["rss"]["no"]||0<base.types["caldav"]["no"]||base.types["bus"]||base.types["mensa"])){base.$content.html("Go to the admin panel and attach a content to this monitor!");base.$content.html('<div class="bs-callout bs-callout-warning"> '+'<h4 id="bs-header">This monitor does not yet have a content attached</h4> '+'<p>Go to the admin panel <code class="highlighter-rouge">/admin</code> and attach a content to this monitor!</p>'+"</div>");return}for(var i=0;i<base.types["pdf"]["no"];i++){console.log("pdf");var $pdf=$('<canvas id="pdf" style="margin:auto;display:block;"></canvas>');appendContent($pdf);base.$content.pdfModule({path:base.types["pdf"]["path"][i]})}for(var j=0;j<base.types["website"]["no"];j++){console.log("website");var $website_iframe=getIFrameObj(base.types["website"]["path"][j]);appendContent($website_iframe)}for(var l=0;l<base.types["rss"]["no"];l++){console.log("rss");var $rss=$('<div id="rss-feeds"></div>');appendContent($rss);base.$content.rssModule({path:base.types["rss"]["path"]})}for(var m=0;m<base.types["caldav"]["no"];m++){console.log("caldav");var $calDav=$('<div id="calendar"></div>');appendContent($calDav);base.$content.CalDAVModule({path:base.types["caldav"]["path"]})}if(base.types["bus"]){console.log("bus");var $bus=$('<div id="bus_panel"></div>');appendContent($bus);base.$content.MensaBusModule("bus")}if(base.types["mensa"]){console.log("mensa");var $mensa=$('<div id="mensa_panel"></div>');appendContent($mensa);base.$content.MensaBusModule("mensa")}for(var k=0;k<base.types["image"]["no"];k++){console.log("images");if(k===0){var $slideshow=$('<div id="slideshow"></div>')}$slideshow.append('<a class="slideshowElements"  href="'+base.types["image"]["path"][k]+'" title="SlideshowItem">item</a>');if(k===base.types["image"]["no"]-1){appendContent($slideshow);$slideshow.children().colorbox(base.colorboxOptions)}}if(base.contentArr.length>1){clearTimeout(base.tOut);switchingContent(base.contentArr,0)}else{base.contentArr[0].show()}}function getIFrameObj(path){return $('<iframe height="100%" width="100%" src="'+path+'" frameborder="0" scrolling="no" sandbox="allow-forms allow-scripts">Your browser does not support IFrame.</iframe>')}function appendContent($obj){$obj.hide();base.contentArr.push($obj);base.$content.append($obj)}function switchingContent(arr,pos){console.log("switching over following content:"+arr.toString()+pos);var $prev=null,$next=null,interval=base.interval;if(pos===0){$prev=arr[arr.length-1]}else{$prev=arr[pos-1]}$next=arr[pos];$.colorbox.close();$prev.hide();if(isSlideshow($next)){console.log("isSlideshow",$next.children());$next.children().colorbox(base.colorboxOptions);interval=base.types["image"]["no"]*base.interval}$next.fadeIn();base.tOut=setTimeout(function(){var newPos=arr.length-1>pos?++pos:0;switchingContent(arr,newPos)},interval*1e3)}function isSlideshow(obj){return obj.is("#slideshow")}function getUrlVars(){var vars=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]}return vars}timedPoll()};base.init()};jQuery.fn.deliverContentModule=function(options){return this.each(function(){new jQuery.deliverContentModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.feedbackModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);var successAlertID=$("#success-alert");var warningAlertID=$("#warning-alert");successAlertID.hide();$("#warning-alert").hide();var response=$.getParameterByName("attach");if(response[0]==="success"){successAlertID.alert();$("#alertSuccessText").text("The system has updated the resource(s) of the monitor(s)");successAlertID.fadeTo(6e3,1e3).slideUp(500,function(){successAlertID.slideUp(500)})}else if(response[0]==="failure"){warningAlertID.alert();$("#alertWarningText").text("The system could not update the content of the monitors");warningAlertID.fadeTo(6e3,1e3).slideUp(500,function(){warningAlertID.slideUp(500)})}response=$.getParameterByName("newMonitor");if(response[0]==="success"){successAlertID.alert();$("#alertSuccessText").text("The system has successfully registered the new monitor");successAlertID.fadeTo(6e3,1e3).slideUp(500,function(){successAlertID.slideUp(500)})}else if(response[0]==="failure"){warningAlertID.alert();$("#alertWarningText").text("The system could not register the new monitor");warningAlertID.fadeTo(6e3,1e3).slideUp(500,function(){warningAlertID.slideUp(500)})}};base.init()};jQuery.fn.feedbackModule=function(options){return this.each(function(){new jQuery.feedbackModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.globalModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.$el.css("background-color","white");jQuery.getParameterByName=function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var results=url.split(name+"=");results.splice(0,1);for(var i=0;i<results.length;i++)results[i]=results[i].replace(/[^a-zA-Z0-9.]/g,"");if(!results)return null;return results};jQuery.getParameters=function getParameters(){var url=window.location.href;return url.split("?")[1]}};base.init()};jQuery.fn.globalModule=function(options){return this.each(function(){new jQuery.globalModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.MensaBusModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.module=options;base.mensaInterval=600*1e3;base.busInterval=300*1e3;console.log("MensaBusModule loaded");function mensaIntervallCall(){console.log("gathering Mensa data");base.getMensaData();setTimeout(function(){mensaIntervallCall()},base.mensaInterval)}function busIntervallCall(){console.log("gathering Bus data");base.getBusData();setTimeout(function(){busIntervallCall()},base.busInterval)}if(base.module==="mensa"){mensaIntervallCall()}else if(base.module==="bus"){busIntervallCall()}};base.getMensaData=function(){$.ajax({dataType:"json",url:"../php/cache/setup.wsgi/mensa",data:"",success:function(data){console.log("Received mensa data");render_mensa(data)}})};base.getBusData=function(){$.ajax({dataType:"json",url:"../php/cache/setup.wsgi/bus",data:"",success:function(data){console.log("Received bus data");render_bus(data)}})};function render_bus(bus_data){var max_busses=12;$("#bus_panel").append($("<div>Current departure times at <i>Stuhlsatzenhaus</i></div>"));var dom_busses=$("<div class='busses'>");$.each(bus_data.busses,function(i,bus){if(i<max_busses){var dom_bus_timing=$("<div class='bus-timing'>");var time=new Date(bus.time);dom_bus_timing.append($("<div class='bus-time'>"+moment(bus.time).format("HH:mm")+"</div>"));if(bus.delay!=0){dom_bus_timing.append($("<div class='bus-delay'>+"+bus.delay+" min</div>"))}if(bus.station=="A"){var direction=" - Richtung Scheidt/Dudweiler"}else{var direction=" - Richtung Universit&auml;t"}var dom_bus_route=$("<div class='bus-route'>");dom_bus_route.append($("<div class='bus-line'>"+bus.line+direction+"</div>"));dom_bus_route.append($("<div class='bus-destination'>"+bus.destination+"</div>"));var dom_bus=$("<div class='bus'>");dom_bus.append(dom_bus_timing);dom_bus.append(dom_bus_route);dom_busses.append(dom_bus)}});$("#bus_panel").html(dom_busses)}function render_mensa(mensa_data){var dom_counters=$("<div>");$.each(mensa_data.counters,function(_,counter){var dom_counter=$("<div class='counter'>");dom_counter.append($("<div class='counter-bar' style='background-color: rgb("+counter.color.r+", "+counter.color.r+", "+counter.color.r+")'>"));var dom_counter_content=$("<div class='counter-content'></div>");dom_counter_content.append($("<div class='counter-header' style='background-color: rgba("+counter.color.r+", "+counter.color.g+", "+counter.color.b+", 0.8)'><span class='counter-title'>"+counter.displayName+"</span><span class='counter-description'>"+counter.description+"</div>"));$.each(counter.meals,function(_,meal){var dom_meal=$("<div class='meal'>");var dom_meal_title=$("<div>");if(meal.category!=null){dom_meal_title.append($("<span class='meal-category'>"+meal.category+":</span>"))}dom_meal_title.append($("<span class='meal-title'>"+meal.name+"</span>"));dom_meal.append(dom_meal_title);$.each(meal.components,function(_,component){dom_meal.append($("<div class='component'>"+component.name+"</div>"))});dom_counter_content.append(dom_meal)});dom_counter.append(dom_counter_content);dom_counters.append(dom_counter)});$("#mensa_panel").html(dom_counters)}base.init()};jQuery.fn.MensaBusModule=function(options){return this.each(function(){new jQuery.MensaBusModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.monitorModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);var monitors=0;var selected=0;var horizontal=0;var vertical=0;var deselectTrigger=false;var selectTrigger=false;var select=$("#selectAllDescription");var monitorParam=""+$.getParameterByName("m");var selectedID;base.$monID=-1e3;base.$el.find(".monitor_overview").each(function(){monitors++;if($(this).find("input").is(":checked")){$(this).css({"border-color":"#333333"});selected++}});$(".labelOption").on("click",function(){var lID=$(this).parent().find("p").html();$.post("../php/add.php",{mID:selectedID,lID:lID}).done(function(data){window.location.replace("index.php?m="+base.$monID)}).fail(function(){console.log("New MonitorName failed")})});$("#addLabel").find("li").each(function(){$(this).find("i").click(function(){var labID=$(this).parent().find("p").text();$.post("../php/delete.php",{labID:labID}).done(function(data){window.location.replace("index.php?m="+base.$monID+"&m=addLabel")}).fail(function(){console.log("Deleting Label failed")})})});for(var i=0;i<monitors;i++){$("#monInput-"+i).change(function(){var monitorSelector=$(".monitor_overview:visible input");var visibleSelected=0;$(".monLi:visible").each(function(){if($(this).find("input").is(":checked"))visibleSelected++});if(this.checked){$(this).parent().css({"border-color":"#333333"});selected++;if($(this).parent().parent().hasClass("vertical")){vertical++}else{horizontal++}if(visibleSelected===monitorSelector.length&&!selectTrigger)$("#selectAllDescription").text(" Deselect All");else $("#selectAllDescription").text(" Select All")}else{$(this).parent().css({"border-color":"transparent"});selected--;if($(this).parent().parent().hasClass("vertical")){vertical--}else{horizontal--}if(!deselectTrigger)$("#selectAllDescription").text(" Select All")}if(selected===0){$("#previewPanel").fadeOut();$(".monitorContainer").delay(400).animate({width:"100%"})}else if(selected===1){$(".monitorContainer").animate({width:"66%"});$("#previewPanel").delay(400).fadeIn();base.$el.find(".monitor_overview").each(function(){if($(this).find("input").is(":checked")){base.$monID=$(this).find(".monitorID").html();selectedID=base.$monID;var monName=$(this).find(".monitorName").html();var name="Name: <span class='detailsName' style='font-weight: normal'>"+monName+"</span> <i id='editNameButton' class='glyphicon glyphicon-pencil'></i><br><br>";var id="Monitor ID: <span style='font-weight: normal'>"+base.$monID+"</span><br><br>";var until="";var date=$(this).find("input").attr("data-until");if(date!==undefined&&date.split("-")[0]<"2030"&&date.split("-")[0]>="2017"){until='Until Date: <span style="font-weight: normal">'+$(this).find("input").attr("data-until")+"</span><br><br>"}var res="Attached resource(s): <span style='font-weight: normal'>"+$(this).find(".resourceContent").html().slice(0,-2)+"</span><br><br>";var labels="";var classList=$(this).parent().attr("class").split(" ");var customLabel=$(this).find("input").attr("data-label").split(" ");for(var i=3;i<classList.length-1;i++){if(classList[i]==="")continue;labels+="<div class='labelbox'><i class='fa fa-tag aria-hidden=true'></i><span>"+classList[i]+"</span>";if(customLabel[i-3]!=="0"){labels+="<div id='removeLabelID"+i+"' class='labelRemoveBox'><i class='fa fa-times aria-hidden=true'></i></div>"}labels+="</div>"}var lab="Labels: <span style='font-weight: normal'>"+labels+"</span>";$("#monDetails").html(name+id+res+until+lab);for(var j=4;j<classList.length;j++){$("#removeLabelID"+j).on("click",function(){var labelSelector=$(this);var labelName=$(this).parent().text();$("#addLabel").find("li").each(function(){if($(this).find("a").text()===labelName){$.post("../php/delete.php",{mID:selectedID,lID:$(this).find("p").text()}).done(function(data){console.log("successful");labelSelector.parent().css("display","none")}).fail(function(){console.log("Deleting label from monitor failed")})}})})}$("#editNameButton").click(function(){var editName="<p style='float: left; margin-right: 10px;'>Name: </p><span style='font-weight: normal'>"+"<input id='newMonName' class='form-control' value='"+monName+"' name='newmonname' maxlength='255' type='text' autofocus>"+"<button id='submitNewMonName' class='btn btn-primary' type='submit' method='post'><i class='glyphicon glyphicon-ok' aria-hidden='true'></i></button>"+"</span><br><br>";$("#monDetails").html(editName+id+res+lab);$("#submitNewMonName").click(function(){if($("#newMonName").val().length<1||$("#newMonName").val().length>255){return}$.post("../php/update.php",{monID:base.$monID,newName:$("#newMonName").val()}).done(function(data){window.location.replace("index.php?m="+base.$monID)}).fail(function(){console.log("New MonitorName failed")})})})}})}else{$("#monDetails").html("horizontal: <span style='font-weight: normal'>"+horizontal+"</span><br><br>vertical: <span style='font-weight: normal'>"+vertical+"</span>")}})}var monArray=monitorParam.split(",");for(var l=0;l<monArray.length;l++){$('input[value="'+monArray[l]+'"]').prop("checked",true).trigger("change")}base.$el.find("a").click(function(){if($(this).find("i").hasClass("fa-angle-down")){$(this).find("i").removeClass("fa-angle-down").addClass("fa-angle-right")}else{$(this).find("i").removeClass("fa-angle-right").addClass("fa-angle-down")}});$(".panel-collapse").on("hidden.bs.collapse",function(){var monitorSelector=$(".monitor_overview:visible input");var visibleSelected=0;$(".monLi:visible").each(function(){if($(this).find("input").is(":checked"))visibleSelected++});if(visibleSelected===monitorSelector.length&&monitorSelector.length!==0){select.text(" Deselect All")}else select.text(" Select All")});$(".panel-collapse").on("shown.bs.collapse",function(){refreshSelectButton()});$("#selectAll").on("click",function(){var monitorSelector=$(".monLi.filter .monitor_overview input");monitorSelector.each(function(index){if(select.text()===" Deselect All"){deselectTrigger=true;$(this).trigger("click")}else{selectTrigger=true;if(!$(this).is(":checked"))$(this).trigger("click")}if(index===monitorSelector.length-1&&deselectTrigger){deselectTrigger=false;select.text(" Select All")}if(index===monitorSelector.length-1&&selectTrigger){selectTrigger=false;select.text(" Deselect All")}})});var filterChecked={};$(".filter.option").each(function(index){filterChecked[$(this).attr("id")]="";console.log($(this).attr("id"))});$(".filter").on("click",function(){var thisSelector=$("."+$(this).text().replace(" Floor",".Floor"));$(".monLi").hide();if(filterChecked[$(this).attr("id")]!==""){filterChecked[$(this).attr("id")]="";$(this).html($(this).text());thisSelector.removeClass("filter");if(refreshFilterSelection())filter()}else{$(this).append(' <i class="fa fa-check" style="color:green" aria-hidden="true"></i>');thisSelector.addClass("filter");filterChecked[$(this).attr("id")]=$(this).text().replace(" Floor",".Floor").replace(" ","");filter();$(".monLi:not(.filter) .monitor_overview input").each(function(){if($(this).is(":checked"))$(this).trigger("click")})}$(".monLi.filter").show();refreshSelectButton();displayWarning()});var warningAlertID=$("#warning-alert");function displayWarning(){if($(".monLi.filter").length===0){warningAlertID.alert();$("#alertWarningText").text("There are no monitors with the applied filter options.");warningAlertID.fadeTo(6e3,1e3).slideUp(500,function(){warningAlertID.slideUp(500)})}}function filter(){var selectionBuilder=".monLi:not(";for(var key in filterChecked){if(filterChecked.hasOwnProperty(key)){if(filterChecked[key]!=="")selectionBuilder+="."+filterChecked[key].replace(" Floor",".Floor").replace(/ /g,"")}}selectionBuilder+=")";$(selectionBuilder).removeClass("filter")}function refreshFilterSelection(){var filterOn=false;$(".filter.option").each(function(index){if(filterChecked[$(this).attr("id")]!==""){filterOn=true;var monitorSelector=$("."+$("#"+$(this).attr("id")).text().replace(" Floor",".Floor").replace(/ /g,""));monitorSelector.addClass("filter")}});if(!filterOn){$(".monLi").addClass("filter");refreshSelectButton();return false}return true}$("#filterAll").on("click",function(){$(".monLi").addClass("filter");$(".monLi").show();refreshSelectButton();for(var key in filterChecked){if(filterChecked.hasOwnProperty(key)){filterChecked[key]=""}}$(".filter.option").each(function(){$(this).html($(this).text())})});function refreshSelectButton(){var monitorSelector=$(".monitor_overview:visible input");var visibleSelected=0;$(".monLi:visible").each(function(){if($(this).find("input").is(":checked"))visibleSelected++});if(visibleSelected<monitorSelector.length){select.text(" Select All")}else select.text(" Deselect All")}if(monArray[1]==="addLabel"){console.log("lol");$("#buttonAddLabel").click()}$("#submitLabelButton").click(function(e){if($("#labelNameInput").val().length<1||$("#labelNameInput").val().length>255){return}var newLabel=$(this).parent().find("input").val();$.post("../php/add.php",{newLabel:newLabel}).done(function(data){window.location.replace("index.php?m="+base.$monID+"&m=addLabel")}).fail(function(){console.log("New Label failed")})})};base.init()};jQuery.fn.monitorModule=function(options){return this.each(function(){new jQuery.monitorModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.newMonitorModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.$alignment=2;base.$location=3;base.$mID;$(".unregisteredMonitors").on("click",function(data){console.log("clicked on: "+$(this).attr("data-value"));console.log("date: "+$(this).attr("data-time"));$("#newMonitorIDModal").text($(this).attr("data-value"));base.$mID=$(this).attr("data-value");$("#newMonitorModal").modal()});$("#newMonPrefixDrop").find("li").find("a").click(function(){console.log("clicked: "+$(this).attr("data-value"));base.$location=$(this).attr("data-value");var btnSelector=$("#dropdownMenuNewMon");btnSelector.text($(this).text());btnSelector.append(' <i class="fa fa-caret-down"></i>')});$("#newMonitorSubmit").click(function(){console.log("new monitor submitted");var monName=$("#newMonitorInput").val();if(monName.length<1){console.log("its fault");return}else console.log("good job");console.log("align: "+base.$alignment+"; location: "+base.$location);$.post("../php/NewMonitor.php",{alignment:base.$alignment,location:base.$location,name:monName,mID:base.$mID}).done(function(data){if(JSON.parse(data)["code"]===200){window.location.replace("index.php?newMonitor=success")}else window.location.replace("index.php?newMonitor=failed")}).fail(function(){window.location.replace("index.php?newMonitor=failed")})});$("#dropdownMenuAlignment").click(function(){if($(this).text().replace(" ","").startsWith("vertical")){base.$alignment=2;$(this).text("horizontal")}else{base.$alignment=1;$(this).text("vertical")}})};base.init()};jQuery.fn.newMonitorModule=function(options){return this.each(function(){new jQuery.newMonitorModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.pdfModule=function(el,options){var base=this;base.init=function(){base.options=$.extend({path:"empty"},options||{});base.el=el;base.$el=jQuery(el);base.interval=300*1e3;console.log("PDFModule loaded");base.getContent(base.options.path)};base.getContent=function(path){PDFJS.disableWorker=true;var loadingTask=PDFJS.getDocument(path);loadingTask.promise.then(function(pdf){console.log("PDF loaded");var pdfDoc=null,pageNum=1,scale=.8,canvas=document.getElementById("pdf"),ctx=canvas.getContext("2d");pdf.getPage(pageNum).then(function(page){console.log("Page loaded");canvas.height=window.innerHeight;var viewport=page.getViewport(canvas.height/page.getViewport(1).height);canvas.width=viewport.width;var renderContext={canvasContext:ctx,viewport:viewport};var renderTask=page.render(renderContext);renderTask.then(function(){console.log("Page rendered")})})},function(reason){console.error(reason)})};base.init()};jQuery.fn.pdfModule=function(options){return this.each(function(){new jQuery.pdfModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.previewModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.$previewFrame=$("iframe#previewFrame");base.$noPreviewFrame=$("#noPreview");$("#resourceTable").find("input").change(function(){if(this.checked){var resType=$(this).attr("data-resType");var resData=$(this).attr("data-resData");if(resType==="pdf"||resType==="image"||resType==="rss"||resType==="website"){base.$noPreviewFrame.hide();base.$previewFrame.show();base.$previewFrame.attr("src",resData);if(resType==="pdf"){base.$previewFrame.removeAttr("sandbox")}else{base.$previewFrame.attr("sandbox","allow-forms allow-scripts")}}else{base.$previewFrame.hide();base.$noPreviewFrame.show()}$("#previewResource").text($(this).val())}})};base.init()};jQuery.fn.previewModule=function(options){return this.each(function(){new jQuery.previewModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.resFormModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);var selected=0;var monitors=""+$.getParameterByName("m");var overview=false;base.$warning=$("#warning-alert-config");base.$success=$("#success-alert-config");if(monitors==""){$(".page-header.page-config").text("Resource Overview");$("#header-form-overview").text("Select the resource(s) you want to edit");$(".k-selectable.resLabels").css("cursor","auto");overview=true}else{$(".page-header.page-config").html('<a class="btn btn-default" href="index.php?'+$.getParameters()+'"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a> Configuration');$("#header-form-overview").text("Select the resource(s) you want to attach to the monitor(s)")}base.$el.find(".k-selectable").each(function(){if(overview)return;if($(this).find("input").is(":checked")){$(this).parent().parent().css({"background-color":"blanchedalmond"});selected++}});base.$el.find(".k-selectable").find("input").change(function(){if(overview)return;if(this.checked){$(this).parent().parent().parent().css({"background-color":"#ADDFFF"});selected++}else{$(this).parent().parent().parent().css({"background-color":"transparent"});selected--}if(selected===0){$("#previewPanel").fadeOut();$("#resForm").delay(400).animate({width:"100%"})}else if(selected===1){$("#resForm").animate({width:"66%"});$("#previewPanel").delay(400).fadeIn()}});document.getElementById("sortNameDown").onclick=function(){sortTable(0,"down")};document.getElementById("sortNameUp").onclick=function(){sortTable(0,"up")};document.getElementById("sortTypeDown").onclick=function(){sortTable(1,"down")};document.getElementById("sortTypeUp").onclick=function(){sortTable(1,"up")};var id=-1,name="";base.$el.find(".fa-trash-o").click(function(){name=$(this).parents("tr").find(".res").val();id=$(this).data("id");$("#deletedItem").html("<b>"+name);$("#delModal").modal()});$("#delButton").click(function(){$.post("../php/Delete.php",{id:id}).done(function(data){var response=JSON.parse(data);if(response.code===200){$("#delModal").modal("hide");base.$success.find("p").text("Item has been deleted");base.$success.show();setTimeout(function(){location.reload()},2e3)}else{$("#delModal").modal("hide");base.$warning.find("p").text(response.msg);base.$warning.show();setTimeout(function(){location.reload()},2e3)}}).fail(function(){base.$warning.show()})})};base.init()};jQuery.fn.resFormModule=function(options){return this.each(function(){new jQuery.resFormModule(this,options)})}})(jQuery);function sortTable(column,direction){var table,rows,switching,i,x,y,shouldSwitch;table=document.getElementById("resourceTable");switching=true;while(switching){switching=false;rows=table.getElementsByTagName("TR");for(i=1;i<rows.length-1;i++){shouldSwitch=false;x=rows[i].getElementsByTagName("TD")[column];y=rows[i+1].getElementsByTagName("TD")[column];var xInner,yInner;if(column===0){xInner=x.getElementsByTagName("p")[0].innerHTML.toLowerCase();yInner=y.getElementsByTagName("p")[0].innerHTML.toLowerCase()}else{xInner=x.innerHTML.toLowerCase();yInner=y.innerHTML.toLowerCase()}if(direction==="down"&&xInner>yInner){shouldSwitch=true;break}else if(direction==="up"&&yInner>xInner){shouldSwitch=true;break}}if(shouldSwitch){rows[i].parentNode.insertBefore(rows[i+1],rows[i]);switching=true}}}(function(jQuery){"use strict";jQuery.resourceModule=function(el,options){var base=this;base.init=function(){jQuery.extend(base.options,options);base.el=el;base.$el=jQuery(el);base.$submitButton=$("#addResourceSubmit");base.$urlForm=$("#urlForm");base.$fileForm=$("#fileForm");base.$warning=$("#warning-alert-config");base.$success=$("#success-alert-config");base.$urlForm.hide();base.$fileForm.hide();base.$dropzoned=false;var fileType=-1;Dropzone.options.droppy={paramName:"userfile",maxFilesize:2,autoProcessQueue:false,dictDefaultMessage:"Click or drag files on top of this field",acceptedFiles:"image/jpeg,.png,.gif,.pdf,.ics",addRemoveLinks:true,success:function(file,response){console.log(JSON.parse(response)["code"]);base.$success.find("p").text("Upload successful. The page will refresh itself now...");base.$success.show()},init:function(){var myDropzone=this;base.$submitButton.on("click",function(){myDropzone.processQueue()});myDropzone.on("complete",function(file,response){if(!file["accepted"])return;myDropzone.removeFile(file);base.$fileForm.hide();base.$el.modal("hide");setTimeout(function(){location.reload()},2e3)})}};var urlHeaderText=["Enter a website URL","Enter a RSS feed URL","How to access the CalDAV data?"];$("#fileTypeDrop").find("li").click(function(){base.$dropzoned=false;$("#warning").hide();fileType=$(this).index();var btnSelector=$("#dropdownMenu1");btnSelector.text($(this).text());btnSelector.val($(this).text());btnSelector.append(' <span class="caret"></span> ');$("#newResModalHeader").text("Submit a new resource");$("#addResourceSubmit").prop("disabled",false);if(fileType>0){base.$urlForm.show();base.$fileForm.hide();if(fileType===3)processCALDavHTML();else{base.$urlForm.html(renderInputField());initHttpListener()}$("#urlHeader").text(urlHeaderText[fileType-1])}else{base.$dropzoned=true;base.$urlForm.hide();base.$fileForm.show()}});function processCALDavHTML(){$("#addResourceSubmit").prop("disabled",true);base.$urlForm.html("");base.$urlForm.append('<label for="url" id="urlHeader">Name:</label>').append('<div class="checkbox caldav"> <label><input id="caldavOpt0"  type="checkbox"  value="">Access through API [Web URL]</label> </div>').append('<div class="checkbox caldav"> <label><input id="caldavOpt1"  type="checkbox" value="">Access through local storage (.ics)</label> </div>').append('<div id="calDavDiv"> </div>');$(".checkbox.caldav").find("input").change(function(){var calDavDivSelector=$("#calDavDiv");calDavDivSelector.html("");if(!this.checked){base.$fileForm.hide();$("#addResourceSubmit").prop("disabled",true);return}if($(this).attr("id")==="caldavOpt0"){$("#caldavOpt1").prop("checked",false);base.$dropzoned=false;base.$fileForm.hide();calDavDivSelector.append(renderInputField());initHttpListener()}else{$("#caldavOpt0").prop("checked",false);base.$dropzoned=true;base.$fileForm.show()}$("#addResourceSubmit").prop("disabled",false)})}function renderInputField(){return'<label for="url" id="urlHeader">Name:</label>'+'<div class="input-group"> <div class="input-group-btn">'+'<button type="button" value="0" id="dropdownMenuURL" class="btn btn-default" '+'data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+"http:// </button></div>\x3c!-- /btn-group --\x3e"+'<input type="text" class="form-control" id="url" aria-label="...">'+"</div>"}function initHttpListener(){$("#dropdownMenuURL").click(function(e){var btnSelector=$("#dropdownMenuURL");if(btnSelector.text().startsWith("https")){btnSelector.val(0);btnSelector.text("http://")}else{btnSelector.val(1);btnSelector.text("https://")}})}base.$submitButton.on("click",function(event){if(fileType<0){base.$warning.find("p").text("Please choose a file type");base.$warning.show()}var resourceResponse=$("#url").val();if(!base.$dropzoned){console.log("skip");if(resourceResponse.length<1){base.$warning.find("p").text("Please enter an URL");base.$warning.show()}else{console.log("value: "+$("#dropdownMenuURL").val());if($("#dropdownMenuURL").val()==="0")resourceResponse=resourceResponse.replace(/^/,"http://");else resourceResponse=resourceResponse.replace(/^/,"https://");var fType=fileType===1?"website":"rss";if(fileType===3)fType="caldav";$.post("../php/Add.php",{name:resourceResponse,type:fType,path:resourceResponse}).done(function(data){console.log("request processed.");base.$urlForm.hide();base.$el.modal("hide");var readTime=1e3;data=JSON.parse(data);var header="";if(data["msg"]!==null)header=data["msg"].toString().toLowerCase();if(header==="sameorigin"||header==="deny"||header==="allow-from"){base.$warning.find("p").text("IFrame might not be able to show the content of "+resourceResponse+" due to same origin constraint. The page will refresh itself now...");base.$warning.show();readTime=5e3}else{base.$success.find("p").text("Entry successful. The page will refresh itself now...");base.$success.show()}setTimeout(function(){location.reload()},readTime)}).fail(function(){base.$warning.find("p").text("Entry failed")})}}console.log("FileType: "+fileType)})};base.init()};jQuery.fn.resourceModule=function(options){return this.each(function(){new jQuery.resourceModule(this,options)})}})(jQuery);(function(jQuery){"use strict";jQuery.rssModule=function(el,options){var base=this;base.init=function(){base.options=$.extend({path:"empty"},options||{});base.el=el;base.$el=jQuery(el);base.interval=300*1e3;console.log("RSSModule loaded");function intervallCall(){$("#rss-feeds").html("");base.getContent(base.options.path);setTimeout(function(){intervallCall()},base.interval)}intervallCall()};base.getContent=function(path){$("#rss-feeds").rss(path,{limit:10,offsetStart:false,offsetEnd:false,ssl:true,layoutTemplate:"<div class='feed-container'>{entries}</div>",entryTemplate:'<div class="panel panel-info"> <div class="panel-heading"> <h3 class="panel-title"><a href="{url}">{title}</a> <div class="pull-right">{date}</div></h3>  </div> <div class="panel-body">{body} </div> </div>',tokens:{foo:"bar",bar:function(entry,tokens){return tokens.date}},dateFormat:"HH:mm, DD.MM.YYYY",dateLocale:"de",effect:"show",success:function(){},onData:function(){}},function callback(){})};base.init()};jQuery.fn.rssModule=function(options){return this.each(function(){new jQuery.rssModule(this,options)})}})(jQuery);
//# sourceMappingURL=modules.min.js.map